# Railway Configuration - Production Deployment
# Learning Voice Agent v2.0.0
# Last Updated: November 23, 2025

[build]
builder = "dockerfile"
dockerfilePath = "Dockerfile.optimized"
watchPatterns = ["app/**", "requirements.txt", "Dockerfile.optimized"]

[deploy]
startCommand = "gunicorn app.main:app --workers ${WORKERS:-4} --worker-class uvicorn.workers.UvicornWorker --bind 0.0.0.0:${PORT:-8000} --timeout 120 --graceful-timeout 30 --keep-alive 5 --access-logfile - --error-logfile - --capture-output"
healthcheckPath = "/health"
healthcheckTimeout = 30
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 10
numReplicas = 1

[deploy.scaling]
minReplicas = 1
maxReplicas = 10
cpuThresholdPercentage = 70
memoryThresholdPercentage = 80
requestsPerSecondThreshold = 100
scaleUpCooldownSeconds = 60
scaleDownCooldownSeconds = 300

[deploy.healthCheck]
path = "/health"
timeout = 30
interval = 15
gracePeriod = 45
unhealthyThreshold = 3

[variables]
# Application
PORT = "8000"
WORKERS = "4"
LOG_LEVEL = "info"
ENVIRONMENT = "production"

# Performance
REDIS_POOL_SIZE = "20"
DB_POOL_SIZE = "10"
MAX_CONNECTIONS = "1000"

# Security - Set via Railway dashboard
# JWT_SECRET_KEY = "<set-in-dashboard>"
# JWT_REFRESH_SECRET_KEY = "<set-in-dashboard>"
# ANTHROPIC_API_KEY = "<set-in-dashboard>"

# Features
RATE_LIMIT_ENABLED = "true"
SECURITY_HEADERS_ENABLED = "true"
WEBSOCKET_ORIGIN_VALIDATION = "true"
