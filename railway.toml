# Railway deployment configuration for single-user production
[build]
builder = "DOCKERFILE"
dockerfilePath = "Dockerfile"

[deploy]
# Health check configuration
healthcheckPath = "/health"
healthcheckTimeout = 100
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 5

# Production start command with 2 workers for single-user deployment
startCommand = "uvicorn app.main:app --host 0.0.0.0 --port $PORT --workers 2"

# Resource allocation - 1GB memory, 1 CPU for single user
numReplicas = 1

# Volume mount for data persistence (SQLite, uploads, ChromaDB)
[[deploy.volumes]]
mountPath = "/app/data"
name = "app-data"

# Environment variables
[deploy.env]
PYTHON_VERSION = "3.11"
PYTHONUNBUFFERED = "1"
DATABASE_URL = "sqlite:///data/learning_captures.db"
CHROMA_PERSIST_DIR = "/app/data/chroma"
LOG_LEVEL = "INFO"

# Required secrets (set via Railway dashboard or CLI):
# - ANTHROPIC_API_KEY (required)
# - OPENAI_API_KEY (optional, for Whisper)
